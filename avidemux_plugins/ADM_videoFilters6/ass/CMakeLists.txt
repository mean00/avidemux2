INCLUDE(admCheckFreeType)
INCLUDE(admCheckFribidi)
INCLUDE(admCheckFontConfig)
ADD_CORE_INCLUDE(ADM_coreSubtitles)
checkFreeType()
checkFribidi("0.19")

IF ((USE_FREETYPE AND USE_FRIBIDI) OR MSVC)
    INCLUDE(vf_plugin)
    SET(ADM_vf_ssa_SRCS ADM_vidASS.cpp)

    ADD_VIDEO_FILTER(ADM_vf_ssa ${ADM_vf_ssa_SRCS})

    IF(DO_COMMON)
        IF(USE_EXTERNAL_LIBASS OR MSVC)
            MESSAGE(STATUS "Checking libass external lib ...")
            PKG_CHECK_MODULES(LIBASS libass)
            IF (LIBASS_FOUND)
                ADD_DEFINITIONS("-DUSE_EXTERNAL_LIBASS")
                ADD_DEFINITIONS(${LIBASS_CFLAGS})
                SET(LIBASS_LIBRARIES ${LIBASS_LDFLAGS})
                MESSAGE(STATUS "   found, lib is ${LIBASS_LIBRARIES}")
            ELSE (LIBASS_FOUND)
                MESSAGE(FATAL_ERROR "Cant locate libass ! cancelling")
            ENDIF (LIBASS_FOUND)
            TARGET_LINK_LIBRARIES(ADM_vf_ssa ${LIBASS_LIBRARIES} ${FREETYPE2_LDFLAGS} ${FRIBIDI_LDFLAGS} ADM_coreSubtitles6)
        ELSE(USE_EXTERNAL_LIBASS OR MSVC)
            ADD_SUBDIRECTORY(ADM_libass)
            TARGET_LINK_LIBRARIES(ADM_vf_ssa ADM_libass ${FREETYPE2_LDFLAGS} ${FRIBIDI_LDFLAGS} ADM_coreSubtitles6)
        ENDIF(USE_EXTERNAL_LIBASS OR MSVC)
        # We force the use of fontconfig
        ADD_DEFINITIONS("-DUSE_FONTCONFIG")
        TARGET_LINK_LIBRARIES(ADM_vf_ssa ${FONTCONFIG_LDFLAGS})
        # Add a simple probe program, only on linux/bsd/...
        IF(WIN32 OR APPLE)
        ELSE(WIN32 OR APPLE)
            ADD_DEFINITIONS(${FREETYPE2_CFLAGS} ${FRIBIDI_CFLAGS} )
            ADD_EXECUTABLE(freetype_probe probe.cpp)
            TARGET_LINK_LIBRARIES(freetype_probe ${FREETYPE2_LDFLAGS} ${FRIBIDI_LDFLAGS} ${FONTCONFIG_LDFLAGS})
        ENDIF(WIN32 OR APPLE)
    ENDIF(DO_COMMON)

    INIT_VIDEO_FILTER(ADM_vf_ssa)
    INSTALL_VIDEO_FILTER(ADM_vf_ssa)
ELSE ((USE_FREETYPE AND USE_FRIBIDI) OR MSVC)
    MESSAGE(STATUS "Fribidi or feetype missing, skipping filter")
ENDIF((USE_FREETYPE AND USE_FRIBIDI) OR MSVC)
